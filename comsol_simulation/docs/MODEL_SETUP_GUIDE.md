# COMSOL分岔道模型设置指南

## 已生成的基准模型文件

- `tjunction_base.mph` - T型分岔道基准模型
- `yjunction_base.mph` - Y型分岔道基准模型

## GUI操作步骤

### 1. 打开模型

1. 启动COMSOL Multiphysics
2. File > Open Model...
3. 选择 `tjunction_base.mph` 或 `yjunction_base.mph`

### 2. 设置边界条件

#### T型分岔道 (tjunction_base.mph)

1. 在模型浏览器中，展开 **组件1 > 层流(spf)**
2. 点击 **入口(in1)**
   - 在图形窗口中，点击左侧边界（入口通道的左端）
   - 确认边界被选中（高亮显示）
   - 查看底部状态栏显示的边界编号（例如：边界 1）
   - 记录此编号

3. 点击 **出口1(out1)**
   - 点击右侧边界（主通道右端）
   - 记录边界编号

4. 点击 **出口2(out2)**
   - 点击上侧边界（侧通道顶端）
   - 记录边界编号

5. 点击 **壁面(wall1)**
   - 选择所有剩余边界（上下通道的侧壁）
   - 可以按住Ctrl键多选

6. 保存模型

#### Y型分岔道 (yjunction_base.mph)

操作类似，选择正确的入口和出口边界。

### 3. 配置数据导出

**关键步骤** - 确保Export导出域内数据而非边界数据：

1. 在模型浏览器中，展开 **结果 > 导出**
2. 点击 **Data** （或创建新的Data导出）
3. 在设置窗口中：
   - **表达式**: 输入 `x, y, u, v, p`
   - **数据**: 选择 **网格** (Mesh) 而非解数据
   - **输出**: 取消勾选"标题"和"描述"
4. 点击"导出"测试，检查生成的txt文件是否包含足够多的数据点
5. 如果只有几百个点，说明导出的是边界数据；需要：
   - 检查"数据"下拉菜单，确保选择"网格"而不是"解"
   - 或者在GUI中创建一个**表面绘图**，然后导出绘图数据

### 4. 验证模型

1. 点击 **研究1 > 计算**
2. 等待求解完成
3. 查看结果：
   - **结果 > 速度场(spf)** - 应该看到抛物线分布
   - **结果 > 压力场(spf)** - 应该看到线性梯度
4. 检查最大速度值是否合理（应约为2倍入口速度）

### 5. 记录边界编号

完成设置后，记录下边界编号供API使用：

```
T型分岔道:
- 入口: 边界 [编号]
- 出口1: 边界 [编号]
- 出口2: 边界 [编号]
- 壁面: 边界 [编号]

Y型分岔道:
- 入口: 边界 [编号]
- 出口1: 边界 [编号]
- 出口2: 边界 [编号]
- 壁面: 边界 [编号]
```

### 5. 参数说明

模型已预定义以下参数：

| 参数 | 默认值 | 说明 |
|------|--------|------|
| v_in | 0.0077 m/s | 入口速度 |
| width | 0.0002 m | 通道宽度 (200μm) |
| L_main | 0.01 m | 主通道长度 |
| L_side/L_branch | 0.005 m | 分支长度 |
| viscosity | 0.001 Pa*s | 流体粘度 |
| density | 1000 kg/m³ | 流体密度 |

## 下一步

完成GUI设置后，运行参数化数据生成脚本：

```bash
python comsol_simulation/scripts/batch/generate_from_base_models.py
```

该脚本将：
1. 加入基准模型
2. 修改参数（入口速度、宽度等）
3. 运行求解
4. 导出数据到HDF5格式

## 故障排除

### 边界选择不生效

- 确保在GUI中正确选择了边界
- 检查边界编号是否正确
- 重新运行求解验证

### 求解失败

- 检查网格是否足够密
- 检查物理场设置是否完整
- 查看COMSOL日志获取详细错误信息

### 数据导出问题

- 确保Export节点表达式正确：`x, y, u, v, p`
- 检查文件路径是否有效
